<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>éº»å°†è®°åˆ† Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/toggle.css">
    <link rel="stylesheet" href="css/lock.css">
    <style>
        #app-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f7fa;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }
        .dark #app-loading {
            background: #1a1a1a;
            color: #fff;
        }
        .loading-logo {
            font-size: 48px;
            margin-bottom: 20px;
            color: #6366f1;
            animation: bounce 2s infinite;
        }
        .loading-bar-container {
            width: 200px;
            height: 6px;
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        .dark .loading-bar-container {
            background: rgba(255,255,255,0.1);
        }
        .loading-bar {
            height: 100%;
            width: 0%;
            background: #6366f1;
            transition: width 0.2s;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        /* Hide app initially to prevent FOUC */
        [v-cloak] { display: none; }

        /* Tutorial Styles */
        .tutorial-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9990;
            pointer-events: auto;
        }
        .tutorial-spotlight {
            position: absolute;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            pointer-events: none;
            z-index: 9991;
        }
        .tutorial-message-box {
            position: absolute;
            width: 280px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 9992;
            transition: all 0.3s ease;
        }
        .dark .tutorial-message-box {
            background: #2d2d2d;
            color: #fff;
        }
        .tutorial-text {
            font-size: 15px;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        .tutorial-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-text {
            background: none;
            border: none;
            color: #999;
            font-size: 13px;
            padding: 8px;
        }
        .btn-primary-small {
            background: #6366f1;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
        }
        .btn-secondary-small {
            background: rgba(0,0,0,0.1);
            color: inherit;
            border: none;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
        }
        .dark .btn-secondary-small {
            background: rgba(255,255,255,0.1);
        }
        /* Seat Modal adjustments */
        .seat-modal-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div id="app-loading">
        <div class="loading-logo"><i class="fas fa-dice"></i></div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loading-progress"></div>
        </div>
        <div style="margin-top: 10px; font-size: 14px; opacity: 0.6;">åŠ è½½ä¸­...</div>
    </div>
    <script>
        // Initialize loading animation immediately
        (function() {
            const loadingBar = document.getElementById('loading-progress');
            if (loadingBar) {
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 90) clearInterval(interval);
                    else {
                        width += Math.random() * 10;
                        if (width > 90) width = 90;
                        loadingBar.style.width = width + '%';
                    }
                }, 100);
                
                // Expose finish function globally
                window.finishLoader = () => {
                    clearInterval(interval);
                    loadingBar.style.width = '100%';
                    setTimeout(() => {
                        const loader = document.getElementById('app-loading');
                        if (loader) {
                            loader.style.opacity = '0';
                            setTimeout(() => loader.remove(), 500);
                        }
                    }, 300);
                };
            } else {
                window.finishLoader = () => {};
            }
        })();
    </script>
    <div id="app" v-cloak>
        <!-- Tutorial Overlay -->
        <div v-if="tutorialState.active" class="tutorial-overlay" @click.stop>
            <div class="tutorial-spotlight" :style="spotlightStyle"></div>
            <div class="tutorial-message-box" :style="messageStyle">
                <div class="tutorial-text">{{ currentTutorialStep?.message }}</div>
                <div class="tutorial-actions">
                    <button class="btn-text" @click="endTutorial">è·³è¿‡</button>
                    <div style="display: flex; gap: 8px;">
                        <button v-if="tutorialState.step > 0" class="btn-secondary-small" @click="prevTutorial">ä¸Šä¸€æ­¥</button>
                        <button class="btn-primary-small" @click="nextTutorial">
                            {{ tutorialState.step === 6 ? 'å®Œæˆ' : 'ä¸‹ä¸€æ­¥' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é”å®šçŠ¶æ€ä¸‹çš„é€æ˜é®ç½©å±‚ -->
        <!-- é”å®šçŠ¶æ€ä¸‹çš„é€æ˜é®ç½©å±‚ -->
        <div v-if="isLocked" class="lock-overlay" @click.stop @touchstart.stop></div>

        <!-- é¡¶éƒ¨æ  -->
        <header class="header" style="z-index: 260;">
            <div class="header-actions">
                <button class="icon-btn" @click="adjustScale(-1)" :class="{ disabled: !canZoomOut }" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="ç¼©å°">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="icon-btn" @click="adjustScale(1)" :class="{ disabled: !canZoomIn }" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="æ”¾å¤§">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="icon-btn" @click="showStats" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="ç»Ÿè®¡å›¾è¡¨">
                    <i class="fas fa-chart-line"></i>
                </button>
                <button class="icon-btn" @click="showHistory" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="å†å²è®°å½•">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn lock-btn" @click="toggleLock" :data-tooltip="isLocked ? 'è§£é”' : 'é”å®š'">
                    <i class="fas" :class="isLocked ? 'fa-lock' : 'fa-lock-open'"></i>
                </button>
                <button class="icon-btn" @click="showHelp" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="æ“ä½œè¯´æ˜">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="icon-btn" @click="showSettings" :style="{ pointerEvents: isLocked ? 'none' : 'auto' }" data-tooltip="è®¾ç½®">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
        <main class="game-area">
            <!-- éª°å­æ¨¡å¼é®ç½© -->
            <div class="dice-overlay" :class="{ show: diceMode }" @click="closeDiceMode"></div>

            <!-- ä¸­é—´è½¬ç›˜ -->
            <div class="center-dial" 
                 :class="{ 
                     'dice-mode': diceMode,
                     'is-rolling': diceMode && isRolling,
                     'roll-finished': diceMode && !isRolling && hasRolled
                 }"
                 :style="{ 
                     transform: diceMode ? '' : `rotate(${dialRotation}deg) scale(${globalScale})`,
                     pointerEvents: isLocked ? 'none' : 'auto'
                 }"
                 @click="handleDialClick">
                <!-- åªæœ‰å½“è¯¥æ–¹å‘å¯¹åº”çš„æ˜¯ä¸œ(dealerIndex)æ—¶æ‰é«˜äº® -->
                <div class="direction dir-0 is-east">æ±</div>
                <div class="direction dir-1">å—</div>
                <div class="direction dir-2">è¥¿</div>
                <div class="direction dir-3">åŒ—</div>
                
                <!-- æ•°å­—ç›´æ¥æ˜¾ç¤ºï¼Œè·Ÿéšçˆ¶å®¹å™¨æ—‹è½¬ï¼Œæ­£å¯¹åº„å®¶ -->
                <div class="dial-round">{{ currentRound }}</div>

                <!-- éª°å­å®¹å™¨ -->
                <div class="dice-container">
                    <div class="dice-box" :style="diceStyles[0]">
                        <div class="dice-face face-1"></div>
                        <div class="dice-face face-2"></div>
                        <div class="dice-face face-3"></div>
                        <div class="dice-face face-4"></div>
                        <div class="dice-face face-5"></div>
                        <div class="dice-face face-6"></div>
                    </div>
                    <div class="dice-box" :style="diceStyles[1]">
                        <div class="dice-face face-1"></div>
                        <div class="dice-face face-2"></div>
                        <div class="dice-face face-3"></div>
                        <div class="dice-face face-4"></div>
                        <div class="dice-face face-5"></div>
                        <div class="dice-face face-6"></div>
                    </div>
                </div>
            </div>

            <!-- ç©å®¶å¡ç‰‡ -->
            <div v-for="(seat, index) in seats" :key="index" 
                 class="player-card" 
                 :class="[
                     `pos-${index}`, 
                     { dealer: dealerIndex === index },
                     { dragging: dragState.dragging && dragState.fromIndex === index && !dragState.draggingNextRound },
                     { 'drag-over': dragState.overIndex === index && (dragState.fromIndex !== index || dragState.draggingNextRound) && (seat || dragState.draggingNextRound) },
                     { 'empty-seat': !seat }
                 ]"
                 :style="{ '--scale-factor': globalScale, pointerEvents: isLocked ? 'none' : 'auto' }"
                 :draggable="!isLocked && seat ? true : false"
                 @click="handleSeatClick(index)"
                 @dragstart="handleDragStart(index, $event)"
                 @dragend="handleDragEnd"
                 @dragover="handleDragOver(index, $event)"
                 @dragleave="handleDragLeave"
                 @drop="handleDrop(index, $event)"
                 @touchstart="handleTouchStart(index, $event)"
                 @touchmove="handleTouchMove($event)"
                 @touchend="handleTouchEnd($event)">
                <!-- åº„å®¶æ ‡è®° -->
                <div v-if="dealerIndex === index && seat" class="dealer-badge">
                    <i v-if="dealerStreak === 0" class="fas fa-crown"></i>
                    <span v-else>{{ dealerStreak }}</span>
                </div>
                
                <div v-if="seat" style="width: 100%; text-align: center;">
                    <div class="player-name">{{ seat }}</div>
                    <div class="player-score">
                        <count-up :to="getPlayerScore(seat)"></count-up>
                    </div>
                    <div class="score-diff">
                        <span v-if="lastDiff[seat]" :class="lastDiff[seat] > 0 ? 'diff-pos' : 'diff-neg'">
                            {{ lastDiff[seat] > 0 ? '+' : '' }}{{ lastDiff[seat] }}
                        </span>
                    </div>
                </div>
                <div v-else style="width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.5;">
                    <i class="fas fa-plus-circle" style="margin-bottom: 8px; font-size: 24px;"></i>
                    <div>å…¥åº§</div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <footer class="action-bar">
            <button class="btn btn-warning" @click="undo" :disabled="history.length === 0" :style="{ opacity: history.length ? 1 : 0.5, pointerEvents: isLocked ? 'none' : 'auto' }">
                <i class="fas fa-undo"></i> æ’¤é”€
            </button>
            <button 
                class="btn btn-secondary next-round-btn" 
                :class="{ dragging: dragState.draggingNextRound }"
                :draggable="!isLocked"
                @click="handleNextRoundClick"
                @dragstart="handleNextRoundDragStart"
                @dragend="handleNextRoundDragEnd"
                @touchstart="handleNextRoundTouchStart"
                @touchmove="handleNextRoundTouchMove"
                @touchend="handleNextRoundTouchEnd"
                :style="{ flex: 1, justifyContent: 'center', pointerEvents: isLocked ? 'none' : 'auto' }">
                ä¸‹ä¸€å±€ <i class="fas fa-chevron-right"></i>
            </button>
        </footer>

        <!-- æ¨¡æ€æ¡†ç»„ä»¶ -->
        
        <!-- 1. ç»“ç®—æ¨¡æ€æ¡† -->
        <div class="modal-overlay settle-modal-overlay" :class="{ show: modals.settle }" @click="closeModal('settle')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">ç»“ç®—åˆ†æ•°</div>
                
                <div class="settle-grid">
                    <div class="player-select-box" 
                         :class="{ 
                             selected: settleFrom, 
                             highlighting: isSelecting && selectingFrom,
                             error: errorFrom
                         }" 
                         @click="handleSelectBoxClick(true)">
                        <span :class="{ 'placeholder-text': !settleFrom, 'player-name-text': settleFrom }">
                            {{ settleFrom || 'è°ç»™åˆ†æ•°?' }}
                        </span>
                    </div>
                    <i class="fas fa-arrow-right arrow-icon"></i>
                    <div class="player-select-box" 
                         :class="{ 
                             selected: settleTo, 
                             highlighting: isSelecting && !selectingFrom,
                             error: errorTo
                         }" 
                         @click="handleSelectBoxClick(false)">
                        <span :class="{ 'placeholder-text': !settleTo, 'player-name-text': settleTo }">
                            {{ settleTo || 'ç»™è°?' }}
                        </span>
                    </div>
                </div>

                <!-- ç©å®¶é€‰æ‹©åˆ—è¡¨ -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 12px;">
                    <div v-for="p in activePlayers" :key="p" 
                         class="list-item" 
                         :class="{ active: (selectingFrom ? settleFrom : settleTo) === p }"
                         style="justify-content: center; margin: 0; padding: 8px 4px; font-size: 13px;"
                         @click="selectSettlePlayer(p)">
                        {{ p }}
                    </div>
                </div>

                <!-- Calculator Display -->
                <div class="calc-display" :class="{ 'has-value': settleAmount }">
                    <span class="amount-value">{{ settleAmount || '0' }}</span>
                    <button v-if="settleAmount" class="clear-btn" @click="settleAmount = ''">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>

                <!-- Numeric Keypad -->
                <div class="numeric-keypad">
                    <button class="key-btn" @click="appendNumber(1)">1</button>
                    <button class="key-btn" @click="appendNumber(2)">2</button>
                    <button class="key-btn" @click="appendNumber(3)">3</button>
                    <button class="key-btn" @click="appendNumber(4)">4</button>
                    <button class="key-btn" @click="appendNumber(5)">5</button>
                    <button class="key-btn" @click="appendNumber(6)">6</button>
                    <button class="key-btn" @click="appendNumber(7)">7</button>
                    <button class="key-btn" @click="appendNumber(8)">8</button>
                    <button class="key-btn" @click="appendNumber(9)">9</button>
                    <button class="key-btn key-cancel" @click="closeModal('settle')">å–æ¶ˆ</button>
                    <button class="key-btn" @click="appendNumber(0)">0</button>
                    <button class="key-btn key-delete" @click="backspaceNumber"><i class="fas fa-backspace"></i></button>
                    <button class="key-btn key-confirm" @click="confirmSettle">ç¡®è®¤</button>
                </div>
            </div>
        </div>

        <!-- 2. é€‰äººå…¥åº§æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.seat }" @click="closeModal('seat')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">é€‰æ‹©ç©å®¶å…¥åº§</div>
                <div class="input-field" style="display: flex; gap: 8px; padding: 4px; border: none; background: transparent;">
                    <input v-model="newPlayerName" class="input-field" placeholder="æ–°ç©å®¶åå­—" style="margin: 0;" @keyup.enter="addNewPlayer">
                    <button class="btn btn-primary" @click="addNewPlayer" style="padding: 0 16px;">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    <div v-for="p in availablePlayers" :key="p.name" class="list-item" @click="sitDown(p.name)">
                        <span>{{ p.name }}</span>
                        <span style="font-weight: bold;">{{ p.score }}</span>
                    </div>
                </div>
                <div class="seat-modal-actions">
                    <button v-if="seats[activeSeatIndex]" class="btn btn-danger" style="background: #ef4444; color: white;" @click="standUp">
                        <i class="fas fa-sign-out-alt"></i> ä¸‹åº§
                    </button>
                    <button class="btn btn-secondary" :style="{ gridColumn: seats[activeSeatIndex] ? 'auto' : '1 / -1', width: '100%' }" @click="closeModal('seat')">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- 3. å†å²è®°å½•æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.history }" @click="closeModal('history')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">å†å²è®°å½•</div>
                <div v-if="history.length === 0" style="text-align: center; opacity: 0.5; padding: 20px;">æš‚æ— è®°å½•</div>
                <div v-else style="max-height: 400px; overflow-y: auto;">
                    <div v-for="(h, i) in history" :key="i" class="history-item">
                        <div class="history-meta">
                            <span>ç¬¬ {{ h.round }} å±€</span>
                            <span>{{ formatTime(h.time) }}</span>
                        </div>
                        <div v-for="(t, ti) in h.transactions" :key="ti" class="history-trans">
                            {{ t.from }} <i class="fas fa-arrow-right" style="font-size: 10px; opacity: 0.5;"></i> {{ t.to }} : 
                            <span class="trans-amount">{{ t.amount }}</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" @click="closeModal('history')">
                    <i class="fas fa-check"></i> å…³é—­
                </button>
            </div>
        </div>

        <!-- 4. ç»Ÿè®¡å›¾è¡¨æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.stats }" @click="closeModal('stats')">
            <div class="modal-card" style="max-width: 600px; width: 95%;" @click.stop>
                <div class="modal-title">åˆ†æ•°èµ°åŠ¿</div>
                <div class="chart-container">
                    <canvas id="scoreChart"></canvas>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" @click="closeModal('stats')">
                    <i class="fas fa-check"></i> å…³é—­
                </button>
            </div>
        </div>

        <!-- 5. è®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.settings }" @click="closeModal('settings')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">è®¾ç½®</div>

                <!-- æ—¥é—´/å¤œé—´æ¨¡å¼å¼€å…³ -->
                <div class="list-item" style="cursor: default; justify-content: space-between;">
                    <div style="display: flex; align-items: center;">
                        <i class="fas" :class="isDark ? 'fa-moon' : 'fa-sun'" style="margin-right: 8px; width: 16px; text-align: center;"></i>
                        <span>{{ isDark ? 'å¤œé—´æ¨¡å¼' : 'æ—¥é—´æ¨¡å¼' }}</span>
                    </div>
                    <div class="toggle-switch" :class="{ active: isDark }" @click="toggleTheme">
                        <div class="toggle-handle"></div>
                    </div>
                </div>

                <div class="list-item" @click="showOriginSet" style="cursor: pointer;">
                    <span><i class="fas fa-crosshairs" style="margin-right: 8px;"></i> è®¾ç½®åŸç‚¹</span>
                </div>

                <div class="list-item" @click="startTutorial" style="cursor: pointer;">
                    <span><i class="fas fa-graduation-cap" style="margin-right: 8px;"></i> é‡æ–°å±•ç¤ºæ•™ç¨‹</span>
                </div>
                
                <div class="list-item" @click="clearData" style="color: var(--danger); cursor: pointer;">
                    <span><i class="fas fa-trash-alt" style="margin-right: 8px;"></i> æ¸…ç©ºæ‰€æœ‰æ•°æ®</span>
                </div>

                <!-- å¼€æºä¿¡æ¯ -->
                <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(0,0,0,0.1); text-align: center; font-size: 12px; opacity: 0.6; line-height: 1.8;">
                    <div>å¼€å‘è€…: baisebaoma</div>
                    <div>
                        <a href="https://github.com/baisebaoma/majhelper" target="_blank" style="color: inherit; text-decoration: none;">
                            <i class="fab fa-github"></i> GitHub ä»“åº“
                        </a>
                    </div>
                    <div>
                        <a href="https://baisebaoma.github.io/majhelper/" target="_blank" style="color: inherit; text-decoration: none;">
                            <i class="fas fa-globe"></i> åœ¨çº¿è®¿é—®
                        </a>
                    </div>
                </div>

                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" @click="closeModal('settings')">
                    <i class="fas fa-check"></i> å…³é—­
                </button>
            </div>
        </div>

        <!-- 6. æ‰‹åŠ¨è°ƒåº„æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.dealerSet }" @click="closeModal('dealerSet')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">æŒ‡å®šåº„å®¶</div>
                <!-- Vue 3 fix: v-if has higher priority than v-for, so we cannot use seat in v-if on the same element -->
                <template v-for="(s, i) in seats" :key="i">
                    <div v-if="s"
                         class="list-item" 
                         :class="{ active: dealerIndex === i }"
                         @click="setDealer(i)">
                        <span>{{ s }}</span>
                        <span v-if="dealerIndex === i"><i class="fas fa-check"></i></span>
                    </div>
                </template>
                <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" @click="closeModal('dealerSet')">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- 7. è®¾ç½®åŸç‚¹æ¨¡æ€æ¡† -->
        <div class="modal-overlay" :class="{ show: modals.originSet }" @click="closeModal('originSet')">
            <div class="modal-card" @click.stop>
                <div class="modal-title">è®¾ç½®åŸç‚¹</div>
                <div v-if="players.length === 0" style="text-align: center; opacity: 0.5; padding: 40px 20px;">
                    è‡³å°‘éœ€è¦ä¸€ä¸ªç©å®¶
                </div>
                <div v-else style="max-height: 400px; overflow-y: auto;">
                    <div v-for="p in players" :key="p.name" class="origin-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600;">{{ p.name }}</span>
                            <button class="btn btn-secondary" style="padding: 4px 12px; font-size: 12px;" @click="setOriginToZero(p.name)">
                                å½’é›¶
                            </button>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span style="font-size: 14px; opacity: 0.7;">èµ·å§‹åˆ†æ•°ï¼š</span>
                            <input 
                                type="number" 
                                :value="p.origin || 0" 
                                @input="updateOrigin(p.name, $event.target.value)"
                                class="input-field" 
                                style="flex: 1; margin: 0; padding: 8px 12px;"
                                placeholder="0">
                        </div>
                        <div style="font-size: 12px; opacity: 0.5; margin-top: 4px;">
                            å½“å‰åˆ†æ•°: {{ getPlayerCurrentScore(p.name) }} | æ˜¾ç¤ºåˆ†æ•°: {{ getPlayerScore(p.name) }}
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" @click="closeModal('originSet')">
                    <i class="fas fa-check"></i> å®Œæˆ
                </button>
            </div>
        </div>

        <!-- 8. æ“ä½œè¯´æ˜æ¨¡æ€æ¡† -->
        <div class="modal-overlay help-modal" :class="{ show: modals.help }" @click="closeModal('help')">
            <div class="modal-card" @click.stop style="max-height: calc(100vh - 280px); display: flex; flex-direction: column;">
                <div class="modal-title" style="flex-shrink: 0;">æ“ä½œè¯´æ˜</div>
                <div class="help-section" style="flex: 1; overflow-y: auto; min-height: 0; padding: 12px; margin-bottom: 8px;">
                    <div style="font-size: 13px; line-height: 1.5; opacity: 0.8;">
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ“Š å±€æ•°ä¸è¿åº„ï¼š</strong>ä¸­é—´é£ç›˜æ•°å­—è¡¨ç¤ºå½“å‰ç¬¬å‡ å±€ï¼›åº„å®¶å³ä¸Šè§’æ˜¾ç¤ºçš‡å† è¡¨ç¤ºé¦–æ¬¡å½“åº„ï¼Œæ˜¾ç¤ºæ•°å­—è¡¨ç¤ºè¿åº„æ¬¡æ•°ï¼ˆå¦‚æ˜¾ç¤º1è¡¨ç¤ºè¿åº„1æ¬¡ï¼Œå³ç¬¬2æ¬¡å½“åº„ï¼‰
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ’° ç»“ç®—åˆ†æ•°ï¼š</strong>æ‹–åŠ¨ç©å®¶Aåˆ°ç©å®¶Bï¼Œè¾“å…¥åˆ†æ•°åç¡®è®¤ï¼ˆAç»™Båˆ†æ•°ï¼‰
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ‘‘ æŒ‡å®šåˆå§‹åº„å®¶ï¼š</strong>åœ¨æœªåæ»¡å‰ï¼Œæ‹–åŠ¨"ä¸‹ä¸€å±€"åˆ°ä»»æ„ä½ç½®æŒ‡å®šåˆå§‹åº„å®¶ï¼ˆä¸å¢åŠ å±€æ•°ï¼‰
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ² æŒ‡å®šåº„å®¶ï¼š</strong>æ¸¸æˆä¸­ï¼Œæ‹–åŠ¨"ä¸‹ä¸€å±€"åˆ°ç©å®¶èº«ä¸Šè¿›è¡Œæ¢åº„æˆ–è¿åº„
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ”„ è‡ªåŠ¨æ¢åº„ï¼š</strong>ç‚¹å‡»"ä¸‹ä¸€å±€"æŒ‰é’®ï¼Œè‡ªåŠ¨æ¢åº„åˆ°ä¸‹ä¸€å®¶å¹¶è¿›å…¥ä¸‹ä¸€å±€
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ² æ‰“éª°å­ï¼š</strong>ç‚¹å‡»ä¸­é—´åœ†ç›˜è¿›å…¥éª°å­æ¨¡å¼ï¼Œå†æ¬¡ç‚¹å‡»è¿›è¡Œæ·éª°å­
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>â†©ï¸ æ’¤é”€æ“ä½œï¼š</strong>ç‚¹å‡»"æ’¤é”€"æŒ‰é’®å¯æ’¤é”€ä¸Šä¸€æ¬¡ç»“ç®—
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ”’ é”å®š/è§£é”ï¼š</strong>ç‚¹å‡»é¡¶éƒ¨é”å½¢å›¾æ ‡å¯é”å®šç•Œé¢ï¼Œé˜²æ­¢è¯¯è§¦
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px; flex-shrink: 0;" @click="closeModal('help')">
                    <i class="fas fa-check"></i> å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script src="js/main.js" type="module"></script>
</body>
</html>