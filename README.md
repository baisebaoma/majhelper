# 通用麻将计分器

一个专为手机设计的通用麻将计分器，适合放在麻将桌上供四人同时查看。支持多玩家轮换、分数结算、历史记录等功能。

## 功能特性

### 核心功能

- **多玩家支持**：支持4个以上玩家，可以轮换参与同一局
- **分数管理**：每个玩家分数从0开始，独立记录和管理
- **局数显示**：显示"第X局"，不依赖特定麻将规则
- **玩家轮换**：点击座位上的玩家名字可更换该座位的玩家
- **庄家管理**：
  - 庄家座位显示红色边框，带有皇冠标记
  - 显示连庄次数（第一次当庄显示皇冠，连庄显示次数）
  - 支持拖拽"下一局"按钮指定庄家和换庄/连庄
  - 中间转盘始终逆时针旋转到正确的庄家位置
- **方向标记**：自动显示東、南、西、北方向，正对当前庄家
- **拖拽结算**：直接拖动玩家卡片到另一玩家进行快速结算
- **拖拽指定庄家**：拖动"下一局"按钮到玩家身上指定庄家
- **撤销功能**：支持撤销最近一次结算操作，防止误操作
- **防息屏**：游戏过程中保持屏幕常亮，避免频繁解锁
- **统计图表**：可视化显示玩家分数走势，谁是"后半场发力"一目了然
- **暗黑模式**：支持深色主题，夜间打牌更护眼
- **交互优化**：数字滚动动画、拖拽动画效果，提升使用体验
- **打骰子**：3D 骰子功能，支持物理动画效果，点击圆盘即可掷骰子
- **强制竖屏**：在手机横屏时强制旋转界面，保持竖屏布局，方便放置在麻将桌中央

### 结算功能

- **拖拽结算**：拖动玩家A到玩家B，输入金额快速结算（支持桌面和移动端）
- **点击结算**：点击"结算"按钮，选择"从"玩家和"到"玩家，输入金额
- **实时反馈**：结算后显示分数增减动画，带有半透明拖拽分身效果
- **自动记录**：每次结算完成后自动记录到历史

### 庄家管理

- **指定初始庄家**：游戏开始前（未坐满时），拖动"下一局"按钮到任意位置指定初始庄家
- **拖拽换庄/连庄**：游戏中，拖动"下一局"按钮到玩家身上：
  - 拖到当前庄家：连庄，连庄次数+1，局数+1
  - 拖到其他玩家：换庄，连庄次数归零，局数+1
- **点击自动换庄**：点击"下一局"按钮，自动换庄到下一家（顺时针），局数+1
- **连庄标记**：庄家座位右上角显示连庄标记（第一次为皇冠👑，连庄显示次数）

### 其他功能

- **历史记录**：查看所有结算历史，包括时间、局数、交易详情
- **数据持久化**：所有数据自动保存到浏览器本地存储
- **清空数据**：支持清空所有数据，重新开始

## 使用方法

### 基本操作

1. **设置玩家**：
   - 点击任意座位设置玩家
   - 可以添加新玩家或选择已有玩家
   - 已在其他座位上的玩家不能重复选择

2. **指定初始庄家**（可选）：
   - 在未坐满时，可以拖动"下一局"按钮到任意位置指定初始庄家
   - 风盘会旋转到对应方向，庄家座位显示红色边框

3. **开始游戏**：
   - 设置好四个座位的玩家后即可开始
   - 点击"下一局"自动换庄到下一家并进入下一局
   - 拖动"下一局"按钮到玩家身上可以指定庄家（连庄或换庄）
   - 如果当前局没有结算记录，会弹出确认提示

4. **结算分数**：
   - **方式一（推荐）**：直接拖动玩家A的卡片到玩家B上，输入金额确认
   - **方式二**：点击"结算"按钮，选择"从"玩家和"到"玩家，输入金额确认

5. **查看信息**：
   - 点击顶部图标可以：
     - 切换深色/浅色模式
     - 查看统计图表
     - 查看历史记录
     - 进行设置（查看操作说明、清空数据等）

### 界面说明

- **四个座位**：分布在屏幕四边，每个座位显示玩家名字和分数
- **中间转盘**：显示当前局数，始终逆时针旋转到正确的庄家方向
- **方向标记**：在局数框和座位之间，显示東、南、西、北，"東"始终对准庄家
- **庄家标记**：
  - 庄家座位有红色边框
  - 右上角显示连庄标记（第一次为皇冠👑，连庄显示次数）
- **拖拽动画**：拖动时会出现半透明的分身，根据位置动态旋转

## 技术特点

- **Vue 3**：使用 Vue 3 构建，响应式数据驱动
- **Chart.js**：使用 Chart.js 绘制精美的分数走势图
- **HTML5 Drag and Drop API**：原生拖拽功能，支持桌面和移动端
- **Touch Events API**：完整的移动端触摸拖拽支持
- **纯HTML/CSS/JavaScript**：单文件应用，无需安装，直接在浏览器中打开即可使用
- **本地存储**：使用localStorage保存数据，刷新页面不丢失
- **Wake Lock API**：调用系统 API 防止屏幕熄灭

## 文件说明

- `index.html`：完整的单文件应用，包含所有HTML、CSS和JavaScript代码

## 使用场景

- 线下麻将游戏计分
- 放在麻将桌中央供四人同时查看
- 需要记录多局游戏分数

## 注意事项

- 数据保存在浏览器本地存储中，清除浏览器数据会丢失所有记录
- 建议定期查看历史记录，确认分数正确
- 清空数据操作不可恢复，请谨慎操作

## 浏览器兼容性

- 现代浏览器（Chrome、Safari、Firefox、Edge等）
- 支持移动端浏览器
- 需要支持localStorage的浏览器

## 更新日志

### v1.6
- **新增打骰子功能**：
  - 3D 物理效果：真实的骰子旋转动画
  - 状态反馈：红光表示正在掷骰子，绿光表示结果已出
  - 随机停顿：模拟真实的掷骰子体验，两个骰子停顿时间随机（1-2.5秒）
  - 优化交互：未掷骰子前点任意位置退出，掷骰子过程中交互锁定
- **优化体验**：修复部分动画效果，提升流畅度

### v1.5
- **新增拖拽结算功能**：拖动玩家卡片到另一玩家上快速结算，支持桌面和移动端
- **新增拖拽指定庄家功能**：拖动"下一局"按钮到玩家身上进行换庄/连庄
- **新增连庄标记**：庄家右上角显示连庄次数（第一次显示皇冠👑，连庄显示数字）
- **优化庄家管理**：
  - 支持在未坐满时拖动指定初始庄家位置
  - 点击"下一局"自动换庄到下一家
  - 移除了换庄/连庄选择弹窗，简化操作
- **优化风盘旋转**：始终逆时针旋转到正确的庄家位置，计算最短路径
- **优化拖拽动画**：半透明分身效果，根据屏幕位置动态旋转
- **优化图表显示**：Y轴只显示整数，图例样式优化
- **优化模态框交互**：支持点击外部关闭，按钮样式统一
- **新增操作说明**：在设置中添加详细的操作说明
- **修复触摸事件警告**：移除可能导致控制台警告的 preventDefault 调用

### v1.4
- 重新实现背景自定义功能，支持预设颜色和HEX输入
- 优化默认背景色，明亮模式为浅灰，暗黑模式为深灰

### v1.3
- 重构代码，使用 Vue 3 框架
- 优化 UI 设计，增加毛玻璃效果
- 优化横屏体验，强制旋转保持竖屏布局
- 优化统计图表，支持显示连续局数和中文标签

### v1.2
- 新增统计图表功能，可视化分数走势
- 新增暗黑模式，支持自动跟随系统或手动切换
- 新增数字滚动动画
- 优化 UI 细节

### v1.1
- 新增撤销功能，可回滚最近一次结算
- 新增防息屏功能 (Wake Lock)，保持屏幕常亮
- 优化界面交互

### v1.0
- 初始版本
- 支持多玩家、分数结算、历史记录等基础功能
- 横屏优化，适合手机使用
